var c=(o,e,t)=>new Promise((s,a)=>{var n=i=>{try{r(t.next(i))}catch(l){a(l)}},h=i=>{try{r(t.throw(i))}catch(l){a(l)}},r=i=>i.done?s(i.value):Promise.resolve(i.value).then(n,h);r((t=t.apply(o,e)).next())});import{getLocalStorage as m,setLocalStorage as p,removeAllAlerts as u,alertMessage as d}from"./utils.js";import g from"./externalServices.js";const T=new g;function f(o){const e=new FormData(o),t={};return e.forEach(function(s,a){t[a]=s}),t}function y(o){const e=o.map(t=>(console.log(t),{id:t.Id,price:t.FinalPrice,name:t.Name,quantity:1}));return e}export default class S{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.subTotal=0,this.orderTotal=0}init(){this.list=m(this.key),this.calculateItemSummary()}calculateItemSummary(){this.itemTotal=this.list.length,this.list.forEach(e=>{this.subTotal+=e.ListPrice}),document.getElementById("orderSummary").innerHTML=`<p>Item Subtotal (${this.itemTotal})</p>
            <p>$${this.subTotal}</p>`,this.calculateOrderTotal()}calculateOrderTotal(){const e=document.getElementById("zip");e.addEventListener("blur",()=>{e.checkValidity()==!0&&(this.list.forEach((t,s)=>{s==0?this.shipping+=10:this.shipping+=2,this.tax=parseFloat(this.subTotal*.06).toFixed(2),this.orderTotal=(parseFloat(this.subTotal)+parseFloat(this.tax)+parseFloat(this.shipping)).toFixed(2)}),document.getElementById("orderSummary").innerHTML+=this.displayOrderTotals())})}displayOrderTotals(){return`<p>Shipping Estimate $${this.shipping}</p>
            <p>Tax $${this.tax}</p>
            <p>Order Total $${this.orderTotal} </p>`}checkout(){return c(this,null,function*(){const e=document.forms.checkout,t=f(e);t.orderDate=new Date,t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=y(this.list),console.log(t);try{const s=yield T.checkout(t);console.log(s),p("so-cart",[]),location.assign("/checkout/checkedout.html")}catch(s){u();for(let a in s.message)d(s.message[a]);console.log(s)}})}}
